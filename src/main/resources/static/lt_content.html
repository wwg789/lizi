<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <link rel="stylesheet" href="http://localhost:80/css/reset.css"/>
    <link rel="stylesheet" href="http://localhost:80/css/global.css"/>
    <link rel="stylesheet" href="http://localhost:80/css/jiugongge.css">
    <link rel="stylesheet" href="http://localhost:80/css/common.css">
    <script src="http://localhost:80/js/getCookie.js"></script>
    <script type="text/javascript" src="http://localhost:80/js/noAgain.js"></script>




</head>
<body style="background-color: #f4f4f4;">
<!--回复框-->
<div id="huifu01"><div id="huifu02"><textarea id="input01"></textarea><button id="button01">提      交</button></div></div>
<div class="writeHead">
    <div class="writeHead_top center">
        <a href=""><img src="img/backIcon.png" alt="" class="backBtn"/></a>
        <h1>帖子内容</h1>
    </div>
</div>
<div style="width: 100%;height: 46px"></div>
<div class="lt_contentTop">

</div>
<div class='spotlightWrapper' style="padding-left: 70px;">
    <ul>
        <li><a href="http://www.17sucai.com/"><img src='http://localhost:80/images/1.jpg' /></a></li>
        <li><a href="http://www.17sucai.com/"><img src='http://localhost:80/images/2.jpg' /></a></li>
        <li><a href="http://www.17sucai.com/"><img src='http://localhost:80/images/3.png' /></a></li>
        <li><a href="http://www.17sucai.com/"><img src='http://localhost:80/images/4.jpg' /></a></li>
    </ul>
</div>
<div class="ltCon_pend"></div>
<div style="width: 100%;height: 50px"></div>
<div class="ltConFoot">
    <div class="ltConFoot_cen center">
        <input type="text" placeholder="说说看法" id="submitEval"/>
        <input type="submit" value="" id="tijiao"/>
    </div>
</div>
</body>
</html>
<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>

<script>
    //获取cookie
    var forumId = getCookie("forumId");
    var path = "http://localhost:80";
    var path0 = path + "/forum/queryForumDetail?id="+forumId;
    var evalId;
    //获取详情
    $.ajax({
        type: "GET",
        url: path0,
        dataType: "json",
        success: function (data) {
            if (data.code == 0) {
                var contentStr = subStringContent(data.data);
                $('.lt_contentTop').html(contentStr);
            } else {
                alert("网络错误：" + data.msg);
            }
        },
    });

    //查询评论列表
    getEvalContent();
    function getEvalContent() {
        $.ajax({
            type: "GET",
            url: path + "/evalReply/queryEvalList?forumInfoId="+forumId,
            dataType: "json",
            success: function (data) {
                if (data.code == 0) {
                    var divstr = subStringEval(data.data);
                    $('.ltCon_pend').html(divstr);
                } else {
                    alert("网络错误：" + data.msg);
                }
            },
        });
    }

    //评论
    $("#tijiao").click(function(){
        $.ajax({
            type: "GET",
            url: path + "/evalReply/addEvalDetail?forumInfoId="+forumId+"&evalContent=" + $("#submitEval").val(),
            dataType: "json",
            success: function (data) {
                if (data.code == 0) {
                    alert("成功");
                    getEvalContent();
                } else {
                    alert("网络错误：" + data.msg);
                }
            },
        });
        $("#submitEval").val("");
    });


    //点击回复按钮显示回复框
    $(".ltCon_pend").delegate("a","click",function(){
        //$("#huifu01").style.display="none";
        //$("#huifu01").css("display", "");
        $("#huifu01").css("display","block");
        evalId = $(this).attr("id");
    });


    //提交回复
    $("#button01").click(function(){
        $.ajax({
            type: "GET",
            url: path + "/evalReply/addReplyDetail?forumEvalId=" + evalId + "&replyContent=" + $("#input01").val(),
            dataType: "json",
            success: function (data) {
                if (data.code == 0) {
                    $("#huifu01").css("display","none");
                    getEvalContent();
                } else {
                    alert("网络错误：" + data.msg);
                }
            },
        });
    });

    //评价详情
    function subStringEval(eval) {
        //评价内容
        var evalStr = "<p class=\"ltCon_pendFont center\">评论区</p>";
        for (var i=0; i<eval.length; i++){
            //回复内容
            var replyStr = "";
            var reply = eval[i].replyList;
            if(reply != null){
                if(reply != null && reply.length > 0){
                    replyStr = subStringReply(reply,eval[i]);
                }
            }

            evalStr +=
                "<div class=\"ltCon_pendCen center\">\n" +
                    "<div class=\"ltCon_pendCen_left\">\n" +
                         "<a href=\"\"><img src=\""+ eval[i].userHeadUrl +"\" alt=\"\"/></a>\n" +
                    "</div>\n" +
                    "<div class=\"ltCon_pendCen_right\">\n" +
                        "<a href=\"\"><h6>"+ eval[i].userNickName +"</h6></a>\n" +
                        "<span>"+ eval[i].chaTime +"</span>\n" +
                        "<div class=\"clear\"></div>\n" +
                        "<p class=\"ltReplay\">" + eval[i].evalContent + "</p>\n" +
                        "<div class=\"ltDo\"><a href='javascript:;' class='reployHuifu' id='"+ eval[i].id +"'>回复</a></div>\n" +
                    "</div>\n" +
                "</div>" +
                replyStr;
        }
        //回复详情
        function subStringReply(reply,eval) {
            for (var i=0; i<reply.length; i++){
                replyStr +=
                    "<div class=\"ltCon_pendCen center\">\n" +
                        "<div class=\"ltCon_pendCen_left\">\n" +
                            "<a href=\"\"><img src=\""+ reply[i].userHeadUrl +"\" alt=\"\"/></a>\n" +
                        "</div>\n" +
                        "<div class=\"ltCon_pendCen_right\">\n" +
                            "<a href=\"\"><h6>"+ reply[i].userNickName +"</h6></a>\n" +
                            "<span>"+ reply[i].chaTime +"</span>\n" +
                            "<div class=\"clear\"></div>\n" +
                            "<p class=\"ltReplay\">回复 <a href=\"\"> "+ eval.userNickName +" </a>"+ reply[i].replyContent +"</p>\n" +
                        "</div>\n" +
                    "</div>";
            }
            return replyStr;
        }
        return evalStr;
    }

    //发帖详情
    function subStringContent(data) {
        var contentStr = "<h1 class=\"lt_contentTop_Title\">"+ data.forumSubject +"</h1>\n" +
            "<div class=\"lt_contentTop_Msg\">\n" +
            "<a href=\"\">\n" +
            "<div class=\"ltConPic\"><img src=\""+ data.userHeadPortraitUrl +"\" alt=\"\"/></div>\n" +
            "<p>"+ data.nickName +"</p>\n" +
            "</a>\n" +
            "<button class=\"ltCon_collect\">收藏</button>\n" +
            "</div>\n" +
            "<div class=\"ltCon_detail\">\n" +
            "<p>"+ data.forumContent +"</p>\n" +
            "</div>";
        return contentStr;
    }


    $(window).load(function(){
        var spotlight = {
            opacity : 0.2,
            imgWidth : $('.spotlightWrapper ul li').find('img').width(),
            imgHeight : $('.spotlightWrapper ul li').find('img').height()
        };
        $('.spotlightWrapper ul li').css({ 'width' : spotlight.imgWidth, 'height' : spotlight.imgHeight });
        $('.spotlightWrapper ul li').hover(function(){
            $(this).find('img').addClass('active').css({ 'opacity' : 1});
            $(this).siblings('li').find('img').css({'opacity' : spotlight.opacity}) ;
        }, function(){
            $(this).find('img').removeClass('active');
        });
        $('.spotlightWrapper ul').bind('mouseleave',function(){
            $(this).find('img').css('opacity', 1);
        });
    });

</script>




