<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>首页</title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <link rel="stylesheet" href="http://localhost:80/css/reset.css"/>
    <link rel="stylesheet" href="http://localhost:80/css/global.css"/>
    <link rel="stylesheet" href="http://localhost:80/css/paging.css">

    <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
    <script src="http://localhost:80/js/jquery-1.11.1.min.js"></script>
    <script src="http://localhost:80/js/paging.js"></script>
    <script src="http://localhost:80/js/utils.js"></script>


</head>
<body style="background-color: #f4f4f4;">
<div class="inHead">
        <div class="inHead_inner center">
            <a href=""><img src="images/logo.png" alt="" class="indexPic1"/></a>
            <div class="indexSearch">
                <input type="text" placeholder="请输入关键词......" name="search"/>
                <input type="button" name="indexBtn"/>
            </div>
        </div>
    </div>
<div class="indexTable">
    <ul>
        <li class="on">热门</li>
        <li>最新</li>
        <li>精华</li>
    </ul>
</div>
<div style="width: 100%;height: 81px"></div>
<div class="indexTable_con" style="display: block"></div>

<div style="background-color: #fff;position: absolute;left: 35%;bottom: 44px;" id="boxfenye">
    <div class="box" id="box"></div>
</div>
<div class="footBar">
    <a href="http://localhost">
        <div class="footBar_pic">
            <img src="http://localhost:80/images/footIcon1.png" alt=""/>
        </div>
        <p class="on">首页</p>
    </a>
    <a id="fatie">
        <div class="footBar_pic">
            <img src="http://localhost:80/images/footIcon2_hover.png" alt=""/>
        </div>
        <p>发帖</p>
    </a>
    <a href="http://localhost/me.html">
        <div class="footBar_pic">
            <img src="http://localhost:80/images/footIcon3_hover.png" alt=""/>
        </div>
        <p>我的</p>
    </a>
</div>
</body>
</html>

<script>
    //获取cookie
    var parentId = getCookie("parentId");
    //定义重新获取到的分页值
    var thisPage;
    $('#fatie').attr("href", "http://localhost/view/write?id="+parentId);

    $.ajax({
        type: "GET",
        url: "http://localhost:80/forum/queryForumList?forunParentId="+parentId,
        dataType: "json",
        success: function (data) {
            if (data.code == 0) {
                var divstr = subString(data.data);
                $('.indexTable_con').html(divstr);
                $('#box').paging({
                    initPageNo: 1, // 初始页码
                    totalPages: data.pages, //总页数
                    totalCount: '合计' + data.count + '条数据', // 条目总数
                    slideSpeed: 600, // 缓动速度。单位毫秒
                    jump: true, //是否支持跳转
                    callback: function(page) { // 回调函数
                        thisPage = page;
                    }
                })

            } else {
                alert("创建失败：" + data.msg);
            }
        },
    });

    $(".indexTable li").click(function(){
        var indexs=$(this).index();
        $(".indexTable li").removeClass("on").eq(indexs).addClass("on");
        $(".indexTable_con").hide().eq(indexs).show();
    });

    $("#boxfenye").click(function(){
        alert(thisPage);
        $.ajax({
            type: "GET",
            url: "http://localhost:80/forum/queryForumList?forunParentId="+parentId + "&page=" + thisPage,
            dataType: "json",
            success: function (data) {
                if (data.code == 0) {
                    var divstr = subString(data.data);
                    $('.indexTable_con').html(divstr);
                } else {
                    alert("网络错误：" + data.msg);
                }
            },
        });
    });


    function subString(data) {
        var divstr="";
        for (var i=0; i<data.length;i++ ) {
            var a = data[i];
            if(i==data.length-1){
                divstr += "<div class=\"indexTable_son\" style=\"padding: 19px 5% 123px 4%;\">\n";
            }else{
                divstr += "<div class=\"indexTable_son\">\n";
            }
            divstr +="<a href=\"http://localhost/lt_content.html\">\n" +
                "            <div class=\"indexTable_sonHead\">\n" +
                "                <div class=\"inHeadPic\">\n" +
                "                    <img src=\""+ a.userHeadPortraitUrl +"\" alt=\"\"/>\n" +
                "                </div>\n" +
                "                <p>"+ a.nickName +"</p>\n" +
                "                <span>精华</span>\n" +
                "                <span>置顶</span>\n" +
                "            </div>\n" +
                "        </a>\n" +
                "        <a href=\"http://localhost/lt_content.html\">\n" +
                "            <div class=\"indexTableCon\">\n" +
                "                <h1>"+ a.forumSubject +"</h1>\n" +
                "                <p>"+ a.forumContent +"</p>\n" +
                "            </div>\n" +
                "        </a>\n" +
                "        <ul class=\"indexTable_conFoot clearfix\">\n" +
                "            <li>收藏<span>"+ a.forumCollectCount +"</span></li>\n" +
                "            <li>评论<span>"+ a.forumEvaluateCount +"</span></li>\n" +
                "            <li>查看<span>"+ a.forumSelectCount +"</span></li>\n" +
                "            <li>10分钟前</li>\n" +
                "        </ul>\n" +
                "    </div>"
        }
        return divstr;
    }


</script>


